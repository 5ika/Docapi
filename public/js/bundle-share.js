function toMarkdown(){if(preview){var e=editeur.getValue().length;1e4>e?md():waitForConvert||(waitForConvert=!0,setTimeout(function(){waitForConvert=!1,md()},1500))}}function md(){var e="";""!==$("#title").val()&&(e="# "+$("#title").val()+"\n");var t=e+editeur.getValue();t=t.replace(/(<script>)/gi,"[Javascript]\n"),t=t.replace(/(<\/script>)/gi,"\n[/Javascript]");var n=marked(t);$("#view").html(n)}function togglePreview(){preview?($("#editor").addClass("m12").removeClass("m6"),$("#view").hide(),$(".fa-eye-slash").removeClass("fa-eye-slash").addClass("fa-eye")):($("#editor").addClass("m6").removeClass("m12"),$("#view").show(),$(".fa-eye").removeClass("fa-eye").addClass("fa-eye-slash"),md()),preview=!preview}function toggleNumberedTitles(){$("#view").toggleClass("numbered-view")}function toggleFullscreen(){editeur.getOption("fullScreen")?editeur.setOption("fullScreen",!1):editeur.setOption("fullScreen",!0),$(".btn-fullscreen-disable").toggleClass("hide")}function parameters(){"none"==$("#modal-parameters").css("display")?$("#modal-parameters").openModal():$("#modal-parameters").closeModal()}function getTags(){var e=$("#tags").val(),t=e.split(/[,;] */);return t.join(", ")}function send(){if(editeur.getValue()!=lastContent)if(""!==$("#title").val()){console.log("Sauvegarde");var e={document:{identifiant:identifiant,title:$("#title").val(),content:editeur.getValue(),username:$("#username").val(),context:$("#context").val(),toc:$("#toc").is(":checked")||!1}};0!==id&&(e._id=id),$.post("/share",e,function(t){if(t&&!t.hasOwnProperty("error")){id=t.id,toast(t.message,2e3);var n=new Date,a=n.getHours()+":"+n.getMinutes();$("#last-save").text("Dernière sauvegarde à "+a),lastContent=e.document.content,t.redirectToEdit&&(window.location.href="/share/"+identifiant)}else toast("Problème serveur. Document non sauvé.",2e3)})}else toast("Pas de titre. Document non sauvé",2e3)}function del(){0!==id?$.ajax({url:"/share/"+id,type:"DELETE",success:function(e){window.location.href="/share/"}}):toast("Document non sauvé",2e3)}function newDocument(){window.location.href="/share"}var toast=Materialize.toast,preview=!1,lastContent="",waitForConvert=!1,editeur;$(document).ready(function(){$(".modal-trigger").leanModal(),$(".link-"+id).addClass("active"),toMarkdown(),editeur=CodeMirror.fromTextArea($("textarea")[0]),editeur.on("change",toMarkdown),window.setInterval(function(){""!==$("#title").val()&&""!==$("#content").val()&&send()},6e4)}),$(document).keydown(function(e){if(e.ctrlKey)switch(e.keyCode){case 83:send(),e.preventDefault();break;case 78:newDocument(),e.preventDefault();break;case 79:togglePreview(),e.preventDefault();break;case 80:toggleFullscreen(),e.preventDefault()}});var socket=io(),firstAcquiring=!0;$(document).ready(function(){$(".CodeMirror").hide(),socket.emit("getCurrentContent"),editeur.on("keyup",function(){socket.emit("update",editeur.getValue())}),socket.on("getCurrentContent",function(){socket.emit("postCurrentContent",editeur.getValue())}),socket.on("postCurrentContent",function(e){firstAcquiring&&($(".CodeMirror").show(),editeur.setValue(e),console.log("SHOW ! ")),firstAcquiring=!1}),socket.on("update",function(e){editeur.setValue(e)})});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRvb2xzLmpzIiwic2hhcmVkLmpzIl0sIm5hbWVzIjpbInRvTWFya2Rvd24iLCJwcmV2aWV3IiwiY2hhckNvdW50IiwiZWRpdGV1ciIsImdldFZhbHVlIiwibGVuZ3RoIiwibWQiLCJ3YWl0Rm9yQ29udmVydCIsInNldFRpbWVvdXQiLCJ0aXRyZSIsIiQiLCJ2YWwiLCJjb250ZW50IiwicmVwbGFjZSIsIm1kQ29udGVudCIsIm1hcmtlZCIsImh0bWwiLCJ0b2dnbGVQcmV2aWV3IiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsImhpZGUiLCJzaG93IiwidG9nZ2xlTnVtYmVyZWRUaXRsZXMiLCJ0b2dnbGVDbGFzcyIsInRvZ2dsZUZ1bGxzY3JlZW4iLCJnZXRPcHRpb24iLCJzZXRPcHRpb24iLCJwYXJhbWV0ZXJzIiwiY3NzIiwib3Blbk1vZGFsIiwiY2xvc2VNb2RhbCIsImdldFRhZ3MiLCJ0YWdzU3RyaW5nIiwidGFncyIsInNwbGl0Iiwiam9pbiIsInNlbmQiLCJsYXN0Q29udGVudCIsImNvbnNvbGUiLCJsb2ciLCJkb2N1bWVudCIsImlkZW50aWZpYW50IiwidGl0bGUiLCJ1c2VybmFtZSIsImNvbnRleHQiLCJ0b2MiLCJpcyIsImlkIiwiX2lkIiwicG9zdCIsImRhdGEiLCJoYXNPd25Qcm9wZXJ0eSIsInRvYXN0IiwibWVzc2FnZSIsIm5vdyIsIkRhdGUiLCJkYXRlIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwidGV4dCIsInJlZGlyZWN0VG9FZGl0Iiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwiZGVsIiwiYWpheCIsInVybCIsInR5cGUiLCJzdWNjZXNzIiwibmV3RG9jdW1lbnQiLCJNYXRlcmlhbGl6ZSIsInJlYWR5IiwibGVhbk1vZGFsIiwiQ29kZU1pcnJvciIsImZyb21UZXh0QXJlYSIsIm9uIiwic2V0SW50ZXJ2YWwiLCJrZXlkb3duIiwiZSIsImN0cmxLZXkiLCJrZXlDb2RlIiwicHJldmVudERlZmF1bHQiLCJzb2NrZXQiLCJpbyIs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RyxRQUFBc0UsV0FBQUMsYUFBQWhFLEVBQUEsWUFBQSxJQUNBUCxRQUFBd0UsR0FBQSxTQUFBM0UsWUFHQTZELE9BQUFlLFlBQUEsV0FDQSxLQUFBbEUsRUFBQSxVQUFBQyxPQUFBLEtBQUFELEVBQUEsWUFBQUMsT0FDQXlCLFFBQ0EsT0FrRUExQixFQUFBOEIsVUFBQXFDLFFBQUEsU0FBQUMsR0FDQSxHQUFBQSxFQUFBQyxRQUNBLE9BQUFELEVBQUFFLFNBRUEsSUFBQSxJQUNBNUMsT0FDQTBDLEVBQUFHLGdCQUNBLE1BRUEsS0FBQSxJQUNBWixjQUNBUyxFQUFBRyxnQkFDQSxNQUVBLEtBQUEsSUFDQWhFLGdCQUNBNkQsRUFBQUcsZ0JBQ0EsTUFFQSxLQUFBLElBQ0F6RCxtQkFDQXNELEVBQUFHLG1CQzFHQSxJQUFBQyxRQUFBQyxLQUNBQyxnQkFBQSxDQUVBMUUsR0FBQThCLFVBQUErQixNQUFBLFdBRUE3RCxFQUFBLGVBQUFVLE9BRUE4RCxPQUFBRyxLQUFBLHFCQUVBbEYsUUFBQXdFLEdBQUEsUUFBQSxXQUNBTyxPQUFBRyxLQUFBLFNBQUFsRixRQUFBQyxjQUdBOEUsT0FBQVAsR0FBQSxvQkFBQSxXQUNBTyxPQUFBRyxLQUFBLHFCQUFBbEYsUUFBQUMsY0FHQThFLE9BQUFQLEdBQUEscUJBQUEsU0FBQS9ELEdBQ0F3RSxpQkFDQTFFLEVBQUEsZUFBQVcsT0FDQWxCLFFBQUFtRixTQUFBMUUsR0FDQTBCLFFBQUFDLElBQUEsWUFFQTZDLGdCQUFBLElBR0FGLE9BQUFQLEdBQUEsU0FBQSxTQUFBL0QsR0FDQVQsUUFBQW1GLFNBQUExRSIsImZpbGUiOiJidW5kbGUtc2hhcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdG9hc3QgPSBNYXRlcmlhbGl6ZS50b2FzdDtcbnZhciBwcmV2aWV3ID0gZmFsc2U7XG52YXIgbGFzdENvbnRlbnQgPSBcIlwiO1xudmFyIHdhaXRGb3JDb252ZXJ0ID0gZmFsc2U7XG52YXIgZWRpdGV1cjtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XG4gICQoJy5tb2RhbC10cmlnZ2VyJykubGVhbk1vZGFsKCk7XG4gICQoJy5saW5rLScgKyBpZCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICB0b01hcmtkb3duKCk7XG5cbiAgLy8gSW5pdGlhbGlzYWlvbiBkZSBsJ8OpZGl0ZXVyXG4gIGVkaXRldXIgPSBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSgkKFwidGV4dGFyZWFcIilbMF0pO1xuICBlZGl0ZXVyLm9uKFwiY2hhbmdlXCIsIHRvTWFya2Rvd24pO1xuXG4gIC8vIFNhdXZlZ2FyZGUgYXV0b21hdGlxdWUgdG91dGVzIGxlcyBtaW51dGVzXG4gIHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICBpZiAoJCgnI3RpdGxlJykudmFsKCkgIT09IFwiXCIgJiYgJCgnI2NvbnRlbnQnKS52YWwoKSAhPT0gXCJcIilcbiAgICAgIHNlbmQoKTtcbiAgfSwgNjAwMDApO1xufSk7XG5cbmZ1bmN0aW9uIHRvTWFya2Rvd24oKSB7XG4gIGlmIChwcmV2aWV3KSB7XG4gICAgdmFyIGNoYXJDb3VudCA9IGVkaXRldXIuZ2V0VmFsdWUoKS5sZW5ndGg7XG4gICAgaWYgKGNoYXJDb3VudCA8IDEwMDAwKSBtZCgpO1xuICAgIGVsc2UgaWYgKCF3YWl0Rm9yQ29udmVydCkge1xuICAgICAgd2FpdEZvckNvbnZlcnQgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgd2FpdEZvckNvbnZlcnQgPSBmYWxzZTtcbiAgICAgICAgbWQoKTtcbiAgICAgIH0sIDE1MDApO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBtZCgpIHtcbiAgdmFyIHRpdHJlID0gXCJcIjtcbiAgaWYgKCQoJyN0aXRsZScpLnZhbCgpICE9PSBcIlwiKSB0aXRyZSA9IFwiIyBcIiArICQoJyN0aXRsZScpLnZhbCgpICsgXCJcXG5cIjtcbiAgdmFyIGNvbnRlbnQgPSB0aXRyZSArIGVkaXRldXIuZ2V0VmFsdWUoKTtcbiAgLy9jb250ZW50ID0gY29udGVudC5yZXBsYWNlKC8oPChbXj5dKyk+KS9pZywgXCJcIik7XG4gIGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoLyg8c2NyaXB0PikvaWcsIFwiW0phdmFzY3JpcHRdXFxuXCIpO1xuICBjb250ZW50ID0gY29udGVudC5yZXBsYWNlKC8oPFxcL3NjcmlwdD4pL2lnLCBcIlxcblsvSmF2YXNjcmlwdF1cIik7XG4gIHZhciBtZENvbnRlbnQgPSBtYXJrZWQoY29udGVudCk7XG4gICQoXCIjdmlld1wiKS5odG1sKG1kQ29udGVudCk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZVByZXZpZXcoKSB7XG4gIGlmIChwcmV2aWV3KSB7XG4gICAgJCgnI2VkaXRvcicpLmFkZENsYXNzKCdtMTInKS5yZW1vdmVDbGFzcygnbTYnKTtcbiAgICAkKCcjdmlldycpLmhpZGUoKTtcbiAgICAkKFwiLmZhLWV5ZS1zbGFzaFwiKS5yZW1vdmVDbGFzcygnZmEtZXllLXNsYXNoJykuYWRkQ2xhc3MoJ2ZhLWV5ZScpO1xuXG4gIH0gZWxzZSB7XG4gICAgJCgnI2VkaXRvcicpLmFkZENsYXNzKCdtNicpLnJlbW92ZUNsYXNzKCdtMTInKTtcbiAgICAkKCcjdmlldycpLnNob3coKTtcbiAgICAkKFwiLmZhLWV5ZVwiKS5yZW1vdmVDbGFzcygnZmEtZXllJykuYWRkQ2xhc3MoJ2ZhLWV5ZS1zbGFzaCcpO1xuICAgIG1kKCk7XG4gIH1cbiAgcHJldmlldyA9ICFwcmV2aWV3O1xufVxuXG5mdW5jdGlvbiB0b2dnbGVOdW1iZXJlZFRpdGxlcygpIHtcbiAgJChcIiN2aWV3XCIpLnRvZ2dsZUNsYXNzKCdudW1iZXJlZC12aWV3Jyk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUZ1bGxzY3JlZW4oKSB7XG4gIGlmIChlZGl0ZXVyLmdldE9wdGlvbihcImZ1bGxTY3JlZW5cIikpXG4gICAgZWRpdGV1ci5zZXRPcHRpb24oXCJmdWxsU2NyZWVuXCIsIGZhbHNlKTtcbiAgZWxzZSBlZGl0ZXVyLnNldE9wdGlvbihcImZ1bGxTY3JlZW5cIiwgdHJ1ZSk7XG4gICQoJy5idG4tZnVsbHNjcmVlbi1kaXNhYmxlJykudG9nZ2xlQ2xhc3MoJ2hpZGUnKTtcbn1cblxuZnVuY3Rpb24gcGFyYW1ldGVycygpIHtcbiAgaWYgKCQoXCIjbW9kYWwtcGFyYW1ldGVyc1wiKS5jc3MoJ2Rpc3BsYXknKSA9PSBcIm5vbmVcIilcbiAgICAkKCcjbW9kYWwtcGFyYW1ldGVycycpLm9wZW5Nb2RhbCgpO1xuICBlbHNlICQoJyNtb2RhbC1wYXJhbWV0ZXJzJykuY2xvc2VNb2RhbCgpO1xufVxuXG5mdW5jdGlvbiBnZXRUYWdzKCkge1xuICB2YXIgdGFnc1N0cmluZyA9ICQoXCIjdGFnc1wiKS52YWwoKTtcbiAgdmFyIHRhZ3MgPSB0YWdzU3RyaW5nLnNwbGl0KC9bLDtdICovKTtcbiAgcmV0dXJuIHRhZ3Muam9pbignLCAnKTtcbn1cblxuJChkb2N1bWVudCkua2V5ZG93bihmdW5jdGlvbihlKSB7XG4gIGlmIChlLmN0cmxLZXkpIHtcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgLy9DVFJMK1MgOiBTYXV2ZWdhcmRlIG1hbnVlbGxlXG4gICAgICBjYXNlIDgzOlxuICAgICAgICBzZW5kKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvL0NUUkwrTiA6IE5vdXZlYXUgZG9jdW1lbnRcbiAgICAgIGNhc2UgNzg6XG4gICAgICAgIG5ld0RvY3VtZW50KCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvL0NUUkwrTyA6IFRvZ2dsZSBQcmV2aWV3XG4gICAgICBjYXNlIDc5OlxuICAgICAgICB0b2dnbGVQcmV2aWV3KCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICAvL0NUUkwrTyA6IFRvZ2dsZSBGdWxsU2NyZWVuXG4gICAgICBjYXNlIDgwOlxuICAgICAgICB0b2dnbGVGdWxsc2NyZWVuKCk7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59KTtcbiIsInZhciBzb2NrZXQgPSBpbygpO1xudmFyIGZpcnN0QWNxdWlyaW5nID0gdHJ1ZTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuXG4gICQoXCIuQ29kZU1pcnJvclwiKS5oaWRlKCk7XG5cbiAgc29ja2V0LmVtaXQoJ2dldEN1cnJlbnRDb250ZW50Jyk7XG5cbiAgZWRpdGV1ci5vbihcImtleXVwXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBzb2NrZXQuZW1pdCgndXBkYXRlJywgZWRpdGV1ci5nZXRWYWx1ZSgpKTtcbiAgfSk7XG5cbiAgc29ja2V0Lm9uKCdnZXRDdXJyZW50Q29udGVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICBzb2NrZXQuZW1pdCgncG9zdEN1cnJlbnRDb250ZW50JywgZWRpdGV1ci5nZXRWYWx1ZSgpKTtcbiAgfSlcblxuICBzb2NrZXQub24oJ3Bvc3RDdXJyZW50Q29udGVudCcsIGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgaWYgKGZpcnN0QWNxdWlyaW5nKSB7XG4gICAgICAkKFwiLkNvZGVNaXJyb3JcIikuc2hvdygpO1xuICAgICAgZWRpdGV1ci5zZXRWYWx1ZShjb250ZW50KTtcbiAgICAgIGNvbnNvbGUubG9nKCdTSE9XICEgJyk7XG4gICAgfVxuICAgIGZpcnN0QWNxdWlyaW5nID0gZmFsc2U7XG4gIH0pXG5cbiAgc29ja2V0Lm9uKFwidXBkYXRlXCIsIGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgZWRpdGV1ci5zZXRWYWx1ZShjb250ZW50KTtcbiAgfSlcbn0pO1xuXG5mdW5jdGlvbiBzZW5kKCkge1xuICBpZiAoZWRpdGV1ci5nZXRWYWx1ZSgpICE9IGxhc3RDb250ZW50KVxuICAgIGlmICgkKCcjdGl0bGUnKS52YWwoKSAhPT0gXCJcIikge1xuICAgICAgY29uc29sZS5sb2coXCJTYXV2ZWdhcmRlXCIpO1xuICAgICAgdmFyIHBhcmFtZXRlcnMgPSB7XG4gICAgICAgIGRvY3VtZW50OiB7XG4gICAgICAgICAgaWRlbnRpZmlhbnQ6IGlkZW50aWZpYW50LFxuICAgICAgICAgIHRpdGxlOiAkKCcjdGl0bGUnKS52YWwoKSxcbiAgICAgICAgICBjb250ZW50OiBlZGl0ZXVyLmdldFZhbHVlKCksXG4gICAgICAgICAgdXNlcm5hbWU6ICQoJyN1c2VybmFtZScpLnZhbCgpLFxuICAgICAgICAgIGNvbnRleHQ6ICQoJyNjb250ZXh0JykudmFsKCksXG4gICAgICAgICAgdG9jOiAkKCcjdG9jJykuaXMoJzpjaGVja2VkJykgfHwgZmFsc2VcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmIChpZCAhPT0gMCkgcGFyYW1ldGVycy5faWQgPSBpZDtcbiAgICAgICQucG9zdChcIi9zaGFyZVwiLCBwYXJhbWV0ZXJzLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAoZGF0YSAmJiAhZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZXJyb3InKSkge1xuICAgICAgICAgIGlkID0gZGF0YS5pZDtcbiAgICAgICAgICB0b2FzdChkYXRhLm1lc3NhZ2UsIDIwMDApO1xuICAgICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgZGF0ZSA9IG5vdy5nZXRIb3VycygpICsgXCI6XCIgKyBub3cuZ2V0TWludXRlcygpO1xuICAgICAgICAgICQoXCIjbGFzdC1zYXZlXCIpLnRleHQoXCJEZXJuacOocmUgc2F1dmVnYXJkZSDDoCBcIiArXG4gICAgICAgICAgICBkYXRlKTtcbiAgICAgICAgICBsYXN0Q29udGVudCA9IHBhcmFtZXRlcnMuZG9jdW1lbnQuY29udGVudDtcbiAgICAgICAgICBpZiAoZGF0YS5yZWRpcmVjdFRvRWRpdCkgd2luZG93LmxvY2F0aW9uLmhyZWYgPVxuICAgICAgICAgICAgJy9zaGFyZS8nICsgaWRlbnRpZmlhbnQ7XG4gICAgICAgIH0gZWxzZSB0b2FzdChcbiAgICAgICAgICBcIlByb2Jsw6htZSBzZXJ2ZXVyLiBEb2N1bWVudCBub24gc2F1dsOpLlwiLFxuICAgICAgICAgIDIwMDApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHRvYXN0KFwiUGFzIGRlIHRpdHJlLiBEb2N1bWVudCBub24gc2F1dsOpXCIsIDIwMDApO1xufVxuXG5mdW5jdGlvbiBkZWwoKSB7XG4gIGlmIChpZCAhPT0gMClcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiBcIi9zaGFyZS9cIiArIGlkLFxuICAgICAgdHlwZTogXCJERUxFVEVcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9zaGFyZS8nO1xuICAgICAgfVxuICAgIH0pO1xuICBlbHNlIHRvYXN0KFwiRG9jdW1lbnQgbm9uIHNhdXbDqVwiLCAyMDAwKTtcbn1cblxuZnVuY3Rpb24gbmV3RG9jdW1lbnQoKSB7XG4gIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9zaGFyZSc7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
